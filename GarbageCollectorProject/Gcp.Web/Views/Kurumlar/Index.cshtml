@{
	ViewBag.Title = "Kurumlar Index";
	Layout = "~/Views/Shared/_panelLayout.cshtml";
}
@section pagescript{

	<script src="../assets/global/scripts/datatable.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
	<script src="../assets/pages/scripts/table-datatables-responsive.js" type="text/javascript"></script>
	<script src="../assets/pages/scripts/ui-confirmations.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/bootstrap-confirmation/bootstrap-confirmation.js" type="text/javascript"></script>
}
@section pagestyle{

	<link href="../assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" type="text/css" />
}
@section veriMenu{
	<span class="selected"></span>
}
@section activeveri{
	active open
}
@section kurumMenu{
	<span class="selected"></span>
}
@section activekurum{
	active open
}
@section pagehead{
	Kurumlar Sayfası
}
@section pagesubhead{
	kurumları görüntüle,düzenle,ekle ve sil
}
<div class="row">

	<div class="col-md-12">
		<!-- BEGIN EXAMPLE TABLE PORTLET-->
		<div class="portlet light bordered">
			<div class="portlet-title">
				<div class="caption font-green">
					<i class="icon-briefcase font-green"></i>
					<span class="caption-subject bold uppercase">Kurumlar Listesi &nbsp;</span>
					<a data-toggle="modal" data-target="#yeniKayit">
						<span class="btn btn-xs btn-info">Yeni Kayıt</span>

					</a>
				</div>
				<div class="tools"> </div>
			</div>
			<div class="portlet-body">
				<div id="sample_2_wrapper" class="dataTables_wrapper no-footer">

					<div>
						<table class="table table-striped table-bordered table-hover dt-responsive dataTable no-footer dtr-column collapsed" width="100%" id="sample_2" role="grid" aria-describedby="sample_2_info" style="width: 100%;">
							<thead>
								<tr role="row">
									<th id="detail" class="control sorting_disabled"></th>
									<th class="all sorting_asc">Kurum İsmi</th>
									<th class="min-phone-l sorting">Kurum Adresi</th>
									<th>Temsilci Kişi</th>
									<th>Temsilci Kişi No</th>
									<th>Çalışma Durumu </th>
									<th class="none sorting">Temsilci Kişi Mail</th>
									<th class="none sorting">Vergi Dairesi </th>
									<th class="none sorting">Vergi No </th>
									<th class="col-md-1">İşlemler</th>

								</tr>
							</thead>
							<tbody id="tableBody"></tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<!-- END EXAMPLE TABLE PORTLET-->
	</div>
</div>


<!--MODALs-->

<div class="modal fade" id="yeniKayit" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Yeni Kayıt</h4>
			</div>
			<div class="modal-body">

				<div class="portlet light bordered">
					<div class="portlet-title">
						<div class="caption font-red-sunglo">
							<i class="icon-settings font-red-sunglo"></i>
							<span class="caption-subject bold uppercase"> Kurum Ekleme Formu</span>
						</div>

					</div>
					<div class="portlet-body form">

						<div class="form-body">
							<div class="form-group">
								<label>Kurum İsmi:</label>
								<input id="kName" class="form-control spinner" type="text" placeholder="Kurum Adı">
							</div>
							<div class="form-group">
								<label>Kurum Adresi:</label>
								<input id="kAdress" class="form-control spinner" type="text" placeholder="Kurum Adresi">
							</div>
							<div class="form-group">
								<label>Temsilci Kişi:</label>
								<input id="kKisi" class="form-control spinner" type="text" placeholder="Temsilci Ad Soyad">
							</div>
							<div class="form-group">
								<label>Temsilci Kişi E-Mail:</label>
								<input id="kMail" class="form-control spinner" type="email" placeholder="temsilci@kurum.com">
							</div>
							<div class="form-group">
								<label>Temsilci Kişi No:</label>
								<input id="kNo" class="form-control spinner" type="number" placeholder="0555 999 99 09">
							</div>
							<div class="form-group">
								<label>Vergi Dairesi</label>
								<input id="kDaire" class="form-control spinner" type="text" placeholder="Vergi Dairesi">
							</div>
							<div class="form-group">
								<label>Vergi Dairesi Adresi</label>
								<input id="kvAdress" class="form-control spinner" type="text" placeholder="Vergi Dairesi Adresi">
							</div>
							<div class="form-group">
								<label>Vergi Dairesi No</label>
								<input id="kDaireNo" class="form-control spinner" type="number" placeholder="Vergi Dairesi No">
							</div>
						</div>

						<div class="form-group">
							<div class="mt-checkbox-list">
								<label class="mt-checkbox">
									Çalışılıyor
									<input type="checkbox" value="true" id="calisma">
									<span></span>
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>


			<div class="modal-footer">
				<button data-bb-handler="ok" type="button" class="btn green" id="saveBtn" data-dismiss="modal">Kaydet</button>
				<button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearKayit()">Vazgeç</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="guncelleKayit" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Güncelleme</h4>
			</div>
			<div class="modal-body">

				<div class="portlet light bordered">
					<div class="portlet-title">
						<div class="caption font-red-sunglo">
							<i class="icon-settings font-red-sunglo"></i>
							<span class="caption-subject bold uppercase"> Kurum Güncelleme Formu</span>
						</div>

					</div>
					<div class="portlet-body form">

						<div class="form-body">
							<div class="form-group">
								<label>Kurum İsmi:</label>
								<input id="keditName" class="form-control spinner" type="text" placeholder="Kurum Adı">
								<input id="keditId" class="form-control spinner" type="hidden">
							</div>
							<div class="form-group">
								<label>Kurum Adresi:</label>
								<input id="keditAdress" class="form-control spinner" type="text" placeholder="Kurum Adresi">
							</div>
							<div class="form-group">
								<label>Temsilci Kişi:</label>
								<input id="kKisi" class="form-control spinner" type="text" placeholder="Temsilci Ad Soyad">
							</div>
							<div class="form-group">
								<label>Temsilci Kişi E-Mail:</label>
								<input id="keditMail" class="form-control spinner" type="email" placeholder="temsilci@kurum.com">
							</div>
							<div class="form-group">
								<label>Temsilci Kişi No:</label>
								<input id="keditNo" class="form-control spinner" type="number" placeholder="0555 999 99 09">
							</div>
							<div class="form-group">
								<label>Vergi Dairesi</label>
								<input id="keditDaire" class="form-control spinner" type="text" placeholder="Vergi Dairesi">
							</div>
							<div class="form-group">
								<label>Vergi Dairesi Adresi</label>
								<input id="kveditAdress" class="form-control spinner" type="text" placeholder="Vergi Dairesi Adresi">
							</div>
							<div class="form-group">
								<label>Vergi Dairesi No</label>
								<input id="keditDaireNo" class="form-control spinner" type="text" placeholder="Vergi Dairesi No">
							</div>
						</div>

						<div class="form-group">
							<div class="mt-checkbox-list">
								<label class="mt-checkbox">
									Çalışılıyor
									<input type="checkbox" value="0" id="editcalisma">
									<span></span>
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="modal-footer">
				<button data-bb-handler="ok" type="button" class="btn green" id="updateBtn" data-dismiss="modal">Güncelle</button>
				<button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearKayit()">Vazgeç</button>
			</div>
		</div>
	</div>
</div>

<script>
	getListe();

	function clearKayit() {
		$('#kName').val('');
		$('#kAdress').val('');
		$('#kMail').val('');
		$('#kNo').val('');
		$('#kDaire').val('');
		$('#kDaireNo').val('');
		$('#kvAdress').val('');

	}

	function getListe() {
		$.ajax({
			url: "/Kurumlar/GetKurumlarHtml",
			success: (data) => {
				$("#tableBody").html(data);
			}
		});
	};

	function deleteKurum() {
		var id = $(this)[0].getAttribute('data-id');
		$.ajax({
			url: "/Kurumlar/Delete/" + id,
			type: "POST",
			success: () => {
				getListe();
			}
		});
	};

	function editDoldur(data) {

		$("#keditName").val((data.KurumIsmi));
		$("#keditId").val((data.KurumID));
		$("#keditAdress").val((data.KurumAdresi));
		$("#keditMail").val((data.TemsilciKisiEmail));
		$("#keditNo").val((data.TemsilciKisiNo));
		$("#keditDaire").val(data.VergiDairesi);
		$("#keditDaireNo").val((data.VergiNo));
		$("#kveditAdress").val((data.VergiDairesiAdresi));
		$("#editcalisma").val((data.CalismaDurumu));

	};

	function getKurum(id) {

		$.ajax({
			url: "/Kurumlar/Edit/" + id,
			type: "GET",
			data: { id: id },
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: (data) => {
				editDoldur(data);
			}
		});
	};

	$("#saveBtn").click(() => {
		$.ajax({
			url: "/Kurumlar/Create",
			type: "POST",
			data: {
				KurumIsmi: $("#kName").val(),
				KurumAdresi: $("#kAdress").val(),
				TemsilciKisi: $("#kKisi").val(),
				TemsilciKisiNo: $("#kNo").val(),
				TemsilciKisiEmail: $("#kMail").val(),
				CalismaDurumu: $("#calisma:checked").val(),
				VergiDairesi: $("#kDaire").val(),
				VergiNo: $("#kDaireNo").val(),
				VergiDairesiAdresi: $("#kvAdress").val()
			},
			success: () => {
				getListe();
			}
		});
	});

	$("#updateBtn").click((id, data) => {

		$.ajax({
			url: "/Kurumlar/Edit/" + id + data,
			type: "POST",
			data: {
				KurumID: $("#keditId").val(),
				KurumIsmi: $("#keditName").val(),
				KurumAdresi: $("#keditAdress").val(),
				TemsilciKisi: $("#kKisi").val(),
				TemsilciKisiEmail: $("#keditEmail").val(),
				TemsilciKisiNo: $("#keditNo").val(),
				VergiDairesi: $("#keditDaire").val(),
				VergiNo: $("#keditDaireNo").val(),
				VergiDairesiAdresi: $("#kveditAdress").val(),
				CalismaDurumu: $("#editcalisma:checked").val()
			},
			success: () => {
				getListe();
			}
		});
	});

</script>
