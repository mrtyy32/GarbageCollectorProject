@{
	ViewBag.Title = "Personel Index";
	Layout = "~/Views/Shared/_panelLayout.cshtml";
}
@section pagescript{

	<script src="../assets/global/scripts/datatable.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
	<script src="../assets/pages/scripts/table-datatables-responsive.js" type="text/javascript"></script>
	<script src="../assets/pages/scripts/ui-confirmations.js" type="text/javascript"></script>
	<script src="../assets/global/plugins/bootstrap-confirmation/bootstrap-confirmation.js" type="text/javascript"></script>
}
@section pagestyle{

	<link href="../assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css" />
	<link href="../assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" type="text/css" />
}
@section veriMenu{
	<span class="selected"></span>
}
@section activeveri{
	active open
}
@section personelMenu{
	<span class="selected"></span>
}
@section activepersonel{
	active open
}
@section pagehead{
	Personel Sayfası
}
@section pagesubhead{
	personelleri görüntüle,düzenle,ekle ve sil
}
<div class="row">

	<div class="col-md-12">
		<!-- BEGIN EXAMPLE TABLE PORTLET-->
		<div class="portlet light bordered">
			<div class="portlet-title">
				<div class="caption font-green">
					<i class="icon-briefcase font-green"></i>
					<span class="caption-subject bold uppercase">Personel Listesi &nbsp;</span>
					<a data-toggle="modal" data-target="#yeniKayit">
						<span class="btn btn-xs btn-info">Yeni Kayıt</span>

					</a>
				</div>
				<div class="tools"> </div>
			</div>
			<div class="portlet-body">
				<div id="sample_2_wrapper" class="dataTables_wrapper no-footer">

					<div>
						<table class="table table-striped table-bordered table-hover dt-responsive dataTable no-footer dtr-column collapsed" width="100%" id="sample_2" role="grid" aria-describedby="sample_2_info" style="width: 100%;">
							<thead>
								<tr role="row">
									<th id="detail" class="control sorting_disabled"></th>
									<th class="all sorting_asc">Ad</th>
									<th class="min-phone-l sorting">Soyad</th>
									<th class="min-tablet sorting">Pozisyon</th>
									<th class="min-tablet sorting">Araç</th>
									<th class="none sorting">Giriş Tarihi : </th>
									<th class="none sorting">Doğum Tarihi : </th>
									<th class="none sorting">Vardiya : </th>
									<th class="desktop sorting">Maaş</th>
									<th class="none sorting">Eğitim : </th>
									<th class="col-md-1">İşlemler</th>

								</tr>
							</thead>
							<tbody id="tableBody"></tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<!-- END EXAMPLE TABLE PORTLET-->
	</div>
</div>


<!--MODALs-->

<div class="modal fade" id="yeniKayit" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Yeni Kayıt</h4>
			</div>
			<div class="modal-body">

				<div class="portlet light bordered">
					<div class="portlet-title">
						<div class="caption font-red-sunglo">
							<i class="icon-settings font-red-sunglo"></i>
							<span class="caption-subject bold uppercase"> Personel Ekleme Formu</span>
						</div>

					</div>
					<div class="portlet-body form">

						<div class="form-body">
							<div class="form-group">
								<label>Adı:</label>
								<input id="pName" class="form-control spinner" type="text" placeholder="Personel Adı">
							</div>

							<div class="form-group">
								<label>Soyadı:</label>
								<input id="pLastName" class="form-control spinner" type="text" placeholder="Personel Soyadı">
							</div>
							<div class="form-group">
								<label>Ünvan</label>
								<select class="form-control" id="dropUnvan">
									<option>Seçiniz</option>
								</select>
							</div>
							<div class="form-group">
								<label>Maaş:</label>
								<input id="pMaas" class="form-control spinner" type="number" placeholder="Personel Maaşı">
							</div>
							<div class="form-group">
								<label>Eğitim</label>
								<select class="form-control" id="dropEgitim">
									<option>Seçiniz</option>
								</select>
							</div>
							<div class="form-group">
								<label>Vardiya</label>
								<select class="form-control" id="dropVardiya">
									<option>Seçiniz</option>
								</select>
							</div>
							<div class="form-group">
								<label>Araç</label>
								<select class="form-control" id="dropArac">
									<option>Seçiniz</option>
								</select>
							</div>
							<div class="form-group">
								<label>Amir</label><small><i class="pull-right">Amir değilse seçiniz</i></small>
								<select class="form-control" id="dropAmir">
									<option>Seçiniz</option>
								</select>
							</div>
							<div class="form-group">
								<label>Doğum Tarihi:</label><small><i class="pull-right">(Örn: 01.01.1990 & 01/01/1990)</i></small>
								<input id="dogumTarihi" class="form-control spinner" type="datetime" placeholder="Doğum Tarihi">
							</div>
							<div class="form-group">
								<label>Giriş Tarihi:</label><small><i class="pull-right">(Örn: 01.01.1990 & 01/01/1990)</i></small>
								<input id="girisTarihi" class="form-control spinner" type="datetime" placeholder="Giriş Tarihi">
							</div>
							<div class="form-group">
								<label>Çıkış Tarihi:</label><small><i class="pull-right">(Örn: 01.01.1990 & 01/01/1990)</i></small>
								<input id="cikisTarihi" class="form-control spinner" type="datetime" placeholder="Çıkış Tarihi">
							</div>
							<div class="form-group">
								<label>İzin Tarihi:</label><small><i class="pull-right">(Örn: 01.01.1990 & 01/01/1990)</i></small>
								<input id="izinTarihi" class="form-control spinner" type="datetime" placeholder="İzin Tarihi">
							</div>
						</div>
						<div class="form-group">

							<div class="mt-checkbox-list">
								<label class="mt-checkbox">
									Çalışıyor
									<input type="checkbox" value="true" id="calisma">
									<span></span>
								</label>
								<label class="mt-checkbox">
									Amir
									<input type="checkbox" value="true" id="amir">
									<span></span>
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>


			<div class="modal-footer">
				<button data-bb-handler="ok" type="button" class="btn green" id="saveBtn" data-dismiss="modal">Kaydet</button>
				<button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearKayit()">Vazgeç</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="guncelleKayit" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Güncelle</h4>
			</div>
			<div class="modal-body">

				<div class="modal-body">

					<div class="portlet light bordered">
						<div class="portlet-title">
							<div class="caption font-red-sunglo">
								<i class="icon-settings font-red-sunglo"></i>
								<span class="caption-subject bold uppercase"> Personel Güncelleme Formu</span>
							</div>

						</div>
						<div class="portlet-body form">

							<div class="form-body">
								<div class="form-group">
									<label>Adı:</label>
									<input id="peditName" class="form-control spinner" type="text">
									<input id="peditId" class="form-control spinner" type="hidden">
								</div>

								<div class="form-group">
									<label>Soyadı:</label>
									<input id="peditLastName" class="form-control spinner" type="text">
								</div>
								<div class="form-group">
									<label>Ünvan</label>
									<select class="form-control" id="dropUnvanEdit"></select>
								</div>
								<div class="form-group">
									<label>Maaş:</label>
									<input id="peditMaas" class="form-control spinner" type="number">
								</div>
								<div class="form-group">
									<label>Eğitim</label>
									<select class="form-control" id="dropEgitimEdit">
									</select>
								</div>
								<div class="form-group">
									<label>Vardiya</label>
									<select class="form-control" id="dropVardiyaEdit">
									</select>
								</div>
								<div class="form-group">
									<label>Amir</label>
									<select class="form-control" id="dropAmirEdit">
										<option>Seçiniz</option>
									</select>
								</div>
								<div class="form-group">
									<label>Doğum Tarihi:</label><small><i class="pull-right">(Örn: 01.01.1990 & 01/01/1990)</i></small>
									<input id="editdogumTarihi" class="form-control spinner" type="datetime">
								</div>
								<div class="form-group">
									<label>Giriş Tarihi:</label><small><i class="pull-right">(Örn: 01.01.1990 & 01/01/1990)</i></small>
									<input id="editgirisTarihi" class="form-control spinner" type="datetime">
								</div>
								<div class="form-group">
									<label>Çıkış Tarihi:</label><small><i class="pull-right">(Örn: 01.01.1990 & 01/01/1990)</i></small>
									<input id="editcikisTarihi" class="form-control spinner" type="datetime">
								</div>
								<div class="form-group">
									<label>İzin Tarihi:</label><small><i class="pull-right">(Örn: 01.01.1990 & 01/01/1990)</i></small>
									<input id="editizinTarihi" class="form-control spinner" type="datetime">
								</div>
							</div>
							<div class="form-group">

								<div class="mt-checkbox-list">
									<label class="mt-checkbox">
										Çalışıyor
										<input type="checkbox" id="editcalisma" name="editcalisma">
										<span></span>
									</label>
									<label class="mt-checkbox">
										Amir
										<input type="checkbox" id="editamir" name="editamir">
										<span></span>
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>



			</div>
			<div class="modal-footer">
				<button data-bb-handler="ok" type="button" class="btn green" id="updateBtn" data-dismiss="modal">Güncelle</button>
				<button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearKayit()">Vazgeç</button>
			</div>
		</div>
	</div>
</div>
<script>
		getListe();

		getDropDownVardiya();
		getDropDownEgitim();
		getDropDownUnvan();
		getDropDownArac();
		getDropDownAmir();

	function clearKayit() {
		$('#vAciklama').val('');
		$('#baslamaDrop option')[0].selected = true;
		$('#bitirmeDrop option')[0].selected = true;

	}

	function getListe() {
		$.ajax({
			url: "/Personel/GetPersonelHtml",
			success: (data) => {
				$("#tableBody").html(data);
			}
		});
	};

	function deletePersonel() {
		var id = $(this)[0].getAttribute('data-id');
		var table = $('#sample_2');
		var oTable = table.dataTable();
		$.ajax({
			url: "/Personel/Delete/" + id,
			type: "POST",
			success: () => {
				getListe();
			}
		});
		dataTable.reload();
	};

	function dateConvert(dateJ) {
		var dateString = dateJ.substr(6);
		var currentTime = new Date(parseInt(dateString));
		var month = currentTime.getMonth() + 1;
		var day = currentTime.getDate();
		var year = currentTime.getFullYear();
		var date = day + "/" + month + "/" + year;
		return date;
	}

	function editDoldur(data) {

		$("#peditId").val((data.PersonelID));
		$("#peditName").val((data.PersonelAd));
		$("#peditLastName").val((data.PersonelSoyad));
		$("#peditMaas").val((data.Maas));
		$("#editdogumTarihi").val(dateConvert(data.DogumTarihi));
		$("#editgirisTarihi").val(dateConvert(data.GirisTarihi));
		if (data.CikisTarihi != null) {
			$("#editcikisTarihi").val(dateConvert(data.CikisTarihi));
		}
		if (data.izinTarihi != null) {
			$("#editizinTarihi").val(dateConvert(data.izinTarihi));
		}
		if (data.CalismaDrumu === true) {
			$("#editcalisma").prop('checked', true);
			$("#editcalisma").attr('checked', 'checked');
			$("#editcalisma").checked = checked;
		}
		$("#editcalisma").prop("checked", false);
		if (data.AmirMi === true) {
			$("#editamir").prop('checked', true);
			$("#editamir").attr('checked', 'checked');
			$("#editamir").checked = checked;
		}
		$("#editamir").prop("checked", false);

	};

	function getPersonel(id) {

		$.ajax({
			url: "/Personel/Edit/" + id,
			type: "GET",
			data: { id: id },
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: (data) => {
				editDoldur(data);
				getDropDownUnvanEdit(data.UnvanID);
				getDropDownEgitimEdit(data.EgitimID);
				getDropDownVardiyaEdit(data.VardiyaID);
				getDropDownAmirEdit(data.AmirID);
			}
		});
	};

	$("#saveBtn").click(() => {
		$.ajax({
			url: "/Personel/Create",
			type: "POST",
			data: {
				PersonelAd: $("#pName").val(),
				PersonelSoyAd: $("#pLastName").val(),
				UnvanID: $("#dropUnvan").val(),
				EgitimID: $("#dropEgitim").val(),
				VardiyaID: $("#dropVardiya").val(),
				AracID: $("#dropArac").val(),
				AmirID: $("#dropAmir").val(),
				Maas: $("#pMaas").val(),
				DogumTarihi: $("#dogumTarihi").val(),
				GirisTarihi: $("#girisTarihi").val(),
				CikisTarihi: $("#cikisTarihi").val(),
				izinTarihi: $("#izinTarihi").val(),
				CalismaDurumu: $("#calisma:checked").val(),
				AmirMi: $("#amir:checked").val()
			},
			success: () => {
				getListe();
			}
		});
	});

	$("#updateBtn").click((id, data) => {

		$.ajax({
			url: "/Personel/Edit/" + id + data,
			type: "POST",
			data: {
				PersonelID: $("#peditId").val(),
				PersonelAd: $("#peditName").val(),
				PersonelSoyAd: $("#peditLastName").val(),
				UnvanID: $("#dropUnvanEdit").val(),
				EgitimID: $("#dropEgitimEdit").val(),
				VardiyaID: $("#dropVardiyaEdit").val(),
				AracID: $("#dropArac").val(),
				AmirID: $("#dropAmir").val(),
				Maas: $("#editMaas").val(),
				DogumTarihi: $("#editdogumTarihi").val(),
				GirisTarihi: $("#editgirisTarihi").val(),
				CikisTarihi: $("#editcikisTarihi").val(),
				izinTarihi: $("#editizinTarihi").val(),
				CalismaDurumu: $("#editcalisma").val(),
				AmirMi: $("#amir:checked").val()
			},
			success: () => {
				getListe();
			}
		});
	});

	//Dropdowns
	function getDropDownAmir() {
		var myDropDownList = $('#dropAmir');

		$.ajax({
			type: "GET",
			url: "/Personel/amirDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				$.each((data),
					function () {
						var adsoyad = this.PersonelAd + " " + this.PersonelSoyad;
						myDropDownList.append($('<option></option>').val(this['PersonelID']).html(adsoyad));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	};

	function getDropDownAmirEdit(id) {
		var myDropDownList = $('#dropAmirEdit');

		$.ajax({
			type: "GET",
			url: "/Personel/amirDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				$.each((data),
					function () {
						var adsoyad = this.PersonelAd + " " + this.PersonelSoyad;
						if (id == this.PersonelID) {
							console.log(id);
							myDropDownList.append($('<option selected="selected"></option>').val(this['PersonelID']).html(adsoyad).attr('selected', 'selected'));
						}
						myDropDownList.append($('<option></option>').val(this['PersonelID']).html(adsoyad));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	};

	function getDropDownUnvan() {
		var myDropDownList = $('#dropUnvan');

		$.ajax({
			type: "GET",
			url: "/Unvan/forDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				$.each((data),
					function () {
						myDropDownList.append($('<option></option>').val(this['UnvanID']).html(this['UnvanAd']));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	};

	function getDropDownUnvanEdit(id) {
		var myDropDownList = $('#dropUnvanEdit');
		$('#dropUnvanEdit').empty();

		$.ajax({
			type: "GET",
			url: "/Unvan/forDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				$.each((data),
					function () {
						if (id == this.UnvanID) {
							console.log(id);
							myDropDownList.append($('<option selected="selected"></option>').val(this['UnvanID']).html(this['UnvanAd']).attr('selected', 'selected'));
						}
						myDropDownList.append($('<option></option>').val(this['UnvanID']).html(this['UnvanAd']));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	}

	function getDropDownEgitimEdit(id) {
		var myDropDownList = $('#dropEgitimEdit');
		$('#dropEgitimEdit').empty();

		$.ajax({
			type: "GET",
			url: "/Egitim/forDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				$.each((data),
					function () {
						if (id == this.EgitimID) {
							myDropDownList.append($('<option selected="selected"></option>').val(this['EgitimID']).html(this['EgitimAd']).attr('selected', 'selected'));
						}
						myDropDownList.append($('<option></option>').val(this['EgitimID']).html(this['EgitimAd']));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	};

	function getDropDownEgitim() {
		var myDropDownList = $('#dropEgitim');

		$.ajax({
			type: "GET",
			url: "/Egitim/forDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				console.log(data);
				$.each((data),
					function () {
						myDropDownList.append($('<option></option>').val(this['EgitimID']).html(this['EgitimAd']));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	};

	function getDropDownArac() {
		var myDropDownList = $('#dropArac');

		$.ajax({
			type: "GET",
			url: "/Araclar/forDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				console.log(data);
				$.each((data),
					function () {
						myDropDownList.append($('<option></option>').val(this['AracID']).html(this['AracPlaka']));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	};

	function getDropDownVardiya() {
		var myDropDownList = $('#dropVardiya');

		$.ajax({
			type: "GET",
			url: "/Vardiya/forDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				console.log(data);
				$.each((data),
					function () {
						myDropDownList.append($('<option></option>').val(this['VardiyaID']).html(this['VardiyaAd']));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	};

	function getDropDownVardiyaEdit(id) {
		var myDropDownList = $('#dropVardiyaEdit');
		$('#dropVardiyaEdit').empty();

		$.ajax({
			type: "GET",
			url: "/Vardiya/forDropDown",
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (data) {
				console.log(data);
				$.each((data),
					function () {
						if (id == this.VardiyaID) {
							myDropDownList.append($('<option selected="selected"></option>').val(this['VardiyaID']).html(this['VardiyaAd']).attr('selected', 'selected'));
						}
						myDropDownList.append($('<option></option>').val(this['VardiyaID']).html(this['VardiyaAd']));
					});
			},
			failure: function (response) {
				alert(response.d);
			}
		});
	};

</script>